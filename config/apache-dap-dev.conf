# Apache Configuration for DAP Application in DEVELOPMENT Mode
# Proxies requests to Vite Dev Server (port 5173) instead of serving static files.
# Uses simplified ProxyPass syntax with upgrade=websocket support (Apache 2.4.47+)

<VirtualHost *:80>
    ServerName myapps.cxsaaslab.com
    ServerAlias myapps.rajarora.csslab
    ServerAlias centos1.rajarora.csslab
    ServerAlias dev.rajarora.csslab
    ServerAlias 172.22.156.33
    
    # Security Headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    # Prevent caching during development
    Header always set Cache-Control "no-cache, no-store, must-revalidate"
    Header always set Pragma "no-cache"

    # Proxy Presets
    ProxyPreserveHost On
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Prefix "/dap"

    # 1. GraphQL API Endpoint (Direct to Backend)
    # Handles both HTTP and WebSocket connections
    ProxyPass /dap/graphql http://127.0.0.1:4000/graphql upgrade=websocket
    ProxyPassReverse /dap/graphql http://127.0.0.1:4000/graphql
    
    # 1.5. DevTools API (Direct to DevTools Service)
    ProxyPass /dap/api/dev http://127.0.0.1:4001/api/dev
    ProxyPassReverse /dap/api/dev http://127.0.0.1:4001/api/dev

    # 2. REST API Endpoints (Direct to Backend)
    ProxyPass /dap/api http://127.0.0.1:4000/api
    ProxyPassReverse /dap/api http://127.0.0.1:4000/api

    # 3. Frontend (Proxy to Vite Dev Server)
    # Handles both HTTP and WebSocket (HMR) connections
    ProxyPass /dap http://127.0.0.1:5173/dap upgrade=websocket
    ProxyPassReverse /dap http://127.0.0.1:5173/dap
    
    # Logging
    ErrorLog /var/log/httpd/dap-dev-error.log
    CustomLog /var/log/httpd/dap-dev-access.log combined
</VirtualHost>
